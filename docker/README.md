# PD-OS Docker Package

This folder contains everything needed to deploy PD-OS (Personal Development Operating System) on any device using Docker.

## Prerequisites

- [Docker](https://www.docker.com/get-started) installed on your system
- Docker Compose (included with Docker Desktop)

## Quick Start

### 1. Copy the entire project to your new device

Copy the whole project folder including this `docker` directory.

### 2. Setup

```bash
cd docker
./scripts/setup.sh
```

This will:
- Check Docker installation
- Create a `.env` file with secure defaults
- Generate a secure JWT secret

### 3. Start PD-OS

```bash
./scripts/start.sh
```

This builds and starts all containers. First run may take a few minutes.

### 4. Access the Application

- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:3001/api

## Scripts Reference

| Script | Description |
|--------|-------------|
| `./scripts/setup.sh` | Initial setup, creates .env file |
| `./scripts/start.sh` | Build and start all services |
| `./scripts/stop.sh` | Stop all services (preserves data) |
| `./scripts/reset.sh` | Stop and DELETE all data |
| `./scripts/logs.sh` | View logs (add service name for specific logs) |
| `./scripts/backup.sh` | Create database backup |
| `./scripts/restore.sh <file>` | Restore database from backup |

## Configuration

Edit the `.env` file to customize:

```env
# Database
DB_USER=pdos_user
DB_PASSWORD=pdos_password    # CHANGE THIS!
DB_NAME=pdos_db
DB_PORT=5432

# Backend
BACKEND_PORT=3001
JWT_SECRET=<auto-generated>
JWT_EXPIRES_IN=7d

# Frontend
FRONTEND_PORT=3000
```

## Common Commands

### View logs
```bash
# All services
./scripts/logs.sh

# Specific service
./scripts/logs.sh backend
./scripts/logs.sh frontend
./scripts/logs.sh db
```

### Backup database
```bash
./scripts/backup.sh
# Creates: backups/pdos_backup_YYYYMMDD_HHMMSS.sql.gz
```

### Restore database
```bash
./scripts/restore.sh backups/pdos_backup_20240101_120000.sql.gz
```

### Stop everything
```bash
./scripts/stop.sh
```

### Complete reset (deletes all data)
```bash
./scripts/reset.sh
```

## Architecture

```
┌─────────────────────────────────────────────────┐
│                  Docker Network                  │
│                                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────────┐  │
│  │ Frontend │  │ Backend  │  │  PostgreSQL  │  │
│  │ (Next.js)│──│ (Express)│──│   Database   │  │
│  │  :3000   │  │  :3001   │  │    :5432     │  │
│  └──────────┘  └──────────┘  └──────────────┘  │
│                                                  │
└─────────────────────────────────────────────────┘
```

## Troubleshooting

### Port already in use
Edit `.env` and change the port:
```env
FRONTEND_PORT=3100
BACKEND_PORT=3101
```

### Container won't start
Check logs for specific service:
```bash
docker compose logs backend
```

### Database connection issues
Ensure the database container is healthy:
```bash
docker compose ps
```

### Reset everything
```bash
./scripts/reset.sh
./scripts/start.sh
```

## Transferring to Another Device

1. **Backup your data** (on source device):
   ```bash
   ./scripts/backup.sh
   ```

2. **Copy files** to new device:
   - Copy the entire project folder
   - Copy the backup file from `docker/backups/`

3. **Setup on new device**:
   ```bash
   cd docker
   ./scripts/setup.sh
   ./scripts/start.sh
   ```

4. **Restore data** (optional):
   ```bash
   ./scripts/restore.sh backups/your_backup_file.sql.gz
   ```

## Data Persistence

- Database data is stored in a Docker volume (`pdos_postgres_data`)
- Data persists across container restarts
- Use `./scripts/backup.sh` to export data
- Use `./scripts/reset.sh` to delete all data

## Security Notes

- Change `DB_PASSWORD` in `.env` before production use
- The `JWT_SECRET` is auto-generated during setup
- Never commit `.env` file to version control
